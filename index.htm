<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>メンタル消耗セルフチェック（0〜3）｜仕事・上司・職場</title>
  <style>
    :root { --fg:#111; --bg:#fff; --muted:#666; --card:#f6f6f7; --line:#e6e6e8; --btn:#111; --btnfg:#fff; }
    @media (prefers-color-scheme: dark){
      :root { --fg:#f2f2f2; --bg:#0b0b0c; --muted:#b7b7b7; --card:#151517; --line:#2a2a2f; --btn:#f2f2f2; --btnfg:#0b0b0c; }
    }
    body{ font-family: system-ui, -apple-system, "Segoe UI", "Noto Sans JP", sans-serif; margin:0; background:var(--bg); color:var(--fg); }
    header{ padding:20px 16px; border-bottom:1px solid var(--line); }
    header h1{ margin:0 0 8px; font-size:18px; }
    header p{ margin:0; color:var(--muted); font-size:13px; line-height:1.5; }
    main{ max-width:980px; margin:0 auto; padding:16px; }
    .grid{ display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 900px){ .grid{ grid-template-columns: 1fr 1fr; } }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px; }
    .card h2{ margin:0 0 10px; font-size:15px; }
    .hint{ color:var(--muted); font-size:12px; line-height:1.5; margin-top:6px; }
    .row{ display:grid; grid-template-columns: 62px 1fr 86px; gap:10px; align-items:center; padding:8px 0; border-top:1px solid var(--line); }
    .row:first-of-type{ border-top:none; }
    .code{ font-variant-numeric: tabular-nums; color:var(--muted); font-size:12px; }
    label{ font-size:13px; line-height:1.35; }
    select{ width:86px; padding:8px 10px; border-radius:10px; border:1px solid var(--line); background:var(--bg); color:var(--fg); }
    .actions{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:12px 0; }
    button{ padding:10px 12px; border-radius:12px; border:1px solid var(--btn); background:var(--btn); color:var(--btnfg); cursor:pointer; font-weight:600; }
    button.secondary{ background:transparent; color:var(--fg); border:1px solid var(--line); }
    .results{ display:grid; grid-template-columns: 1fr; gap:12px; margin-top:12px; }
    @media (min-width: 900px){ .results{ grid-template-columns: 1.2fr 0.8fr; } }
    .metric{ display:flex; justify-content:space-between; padding:10px 12px; background:var(--bg); border:1px solid var(--line); border-radius:12px; font-size:13px; }
    .metric b{ font-variant-numeric: tabular-nums; }
    .pill{ display:inline-block; padding:3px 9px; border-radius:999px; border:1px solid var(--line); font-size:12px; margin-left:8px; }
    textarea{ width:100%; min-height:92px; padding:10px 12px; border-radius:12px; border:1px solid var(--line); background:var(--bg); color:var(--fg); font-size:13px; line-height:1.5; }
    .promptBox{ min-height:140px; }
    .small{ font-size:12px; color:var(--muted); line-height:1.5; margin-top:8px;}
    .toplist li{ margin:6px 0; font-size:13px; }
    .footer{ padding:10px 0 28px; color:var(--muted); font-size:12px; line-height:1.6;}
    .twoCol{ display:grid; grid-template-columns: 1fr; gap:10px; }
    @media (min-width: 900px){ .twoCol{ grid-template-columns: 1fr 1fr; } }
  </style>
</head>
<body>
<header>
  <h1>メンタル消耗セルフチェック（0〜3）｜仕事・上司・職場</h1>
  <p>0=問題なし / 1=軽い / 2=中 / 3=強い（ほぼ毎日・睡眠/体調にも影響）<br>
  点数は「診断」ではなく、いまの消耗度を見える化するための目安です。個人情報（会社名・氏名など）は入れないでください。</p>
</header>

<main>
  <div class="actions">
    <button id="calcBtn">計算する</button>
    <button class="secondary" id="genPromptBtn">AI用プロンプトを生成</button>
    <button class="secondary" id="resetBtn">リセット</button>
  </div>

  <div class="grid" id="cards"></div>

  <div class="results">
    <div class="card">
      <h2>結果</h2>
      <div id="metrics"></div>
      <div class="small">
        判定ルール：<br>
        ・各カテゴリ（0〜30）：0〜7=緑 / 8〜15=黄 / 16〜23=橙 / 24〜30=赤<br>
        ・総合（0〜90）：0〜20=緑 / 21〜40=黄 / 41〜60=橙 / 61〜90=赤
      </div>
    </div>

    <div class="card">
      <h2>点数が高かった項目（上位5つ）</h2>
      <ol class="toplist" id="top5"></ol>
      <div class="hint">同点は複数出ます。0点が多い場合は少なく表示されます。</div>
    </div>
  </div>

  <div class="card" style="margin-top:12px;">
    <h2>補足（任意）</h2>
    <div class="twoCol">
      <div>
        <label for="deadline"><b>期限・直近イベント</b>（例：今週中に方向性合意／来週の面談）</label>
        <textarea id="deadline" placeholder="例：今週金曜までに方向性を固めたい"></textarea>
      </div>
      <div>
        <label for="avoid"><b>避けたい事故</b>（例：手戻り／責任転嫁／評価ダウン／体調悪化）</label>
        <textarea id="avoid" placeholder="例：手戻りと評価ダウン、睡眠悪化"></textarea>
      </div>
    </div>
    <div style="margin-top:10px;">
      <label for="context"><b>状況（200字くらい）</b></label>
      <textarea id="context" placeholder="例：上司の方針が揺れて回収が起きた。帰宅後も反芻が止まらず睡眠が浅い。"></textarea>
    </div>
  </div>

  <div class="card" style="margin-top:12px;">
    <h2>AI用プロンプト（点数→集計→評価→対処）</h2>
    <textarea class="promptBox" id="promptOut" readonly placeholder="「AI用プロンプトを生成」を押すと、ここに出ます。"></textarea>
    <div class="actions" style="margin-top:10px;">
      <button class="secondary" id="copyPromptBtn">プロンプトをコピー</button>
    </div>
    <div class="small">
      使い方：このプロンプトをChatGPT等に貼り付けて送ってください。<br>
      注意：医療診断ではありません。睡眠・体調の影響が強い場合は、早めに相談導線（産業医/EAP等）も確保してください。
    </div>
  </div>

  <div class="footer">
    ローカルで動作します（ネット接続不要）。このHTMLを保存してブラウザで開くだけです。<br>
    もし「チェック項目をあなたの記事の文章に合わせて言い回し調整」したい場合は、気軽に言ってください。
  </div>
</main>

<script>
const SECTIONS = [
  { key:'W', title:'仕事（W01〜W10）', items:[
    ['W01','期限が現実的じゃない'],
    ['W02','優先順位がつけられない（やること過多）'],
    ['W03','役割・ゴールが曖昧で正解が見えない'],
    ['W04','割り込みが多く集中が切れる'],
    ['W05','ミス・抜けが増えた／確認が怖い'],
    ['W06','仕事が頭から離れない（反芻）'],
    ['W07','休んでも疲れが抜けない'],
    ['W08','時間が足りない感覚が常にある'],
    ['W09','抱え込み（相談できず自分で持つ）'],
    ['W10','仕事が睡眠・食欲・体調に影響している'],
  ]},
  { key:'B', title:'上司（B01〜B10）', items:[
    ['B01','指示が曖昧／後出しが多い'],
    ['B02','方針が変わる（昨日と今日で正解が違う）'],
    ['B03','修正・ダメ出しが多く基準が見えない'],
    ['B04','任せた→途中で回収／責任だけ残る'],
    ['B05','即レス圧が強い（返信速度＝評価）'],
    ['B06','機嫌で温度差がある'],
    ['B07','正論で詰められ相談しにくい'],
    ['B08','相談しても支援が得られない（放置／丸投げ）'],
    ['B09','減点方式に感じる'],
    ['B10','上司のことを考えるだけでしんどい'],
  ]},
  { key:'P', title:'職場（P01〜P10）', items:[
    ['P01','空気が重く話しかけづらい'],
    ['P02','責め文化・詮索がある'],
    ['P03','孤立感がある（相談相手がいない）'],
    ['P04','情報共有が弱く後からひっくり返る'],
    ['P05','基準がバラバラ／不公平感がある'],
    ['P06','休憩・休暇が取りにくい雰囲気'],
    ['P07','ミスが許されない空気が強い'],
    ['P08','負荷が偏っている'],
    ['P09','職場にいるだけで体が固くなる'],
    ['P10','職場に行くと体調が崩れやすい'],
  ]},
];

function level30(x){
  if (x<=7) return '緑';
  if (x<=15) return '黄';
  if (x<=23) return '橙';
  return '赤';
}
function level90(x){
  if (x<=20) return '緑';
  if (x<=40) return '黄';
  if (x<=60) return '橙';
  return '赤';
}

function buildUI(){
  const cards = document.getElementById('cards');
  cards.innerHTML = '';
  SECTIONS.forEach(sec=>{
    const card = document.createElement('div');
    card.className = 'card';
    const h = document.createElement('h2');
    h.textContent = sec.title;
    card.appendChild(h);

    sec.items.forEach(([code,label])=>{
      const row = document.createElement('div');
      row.className = 'row';

      const c = document.createElement('div');
      c.className = 'code';
      c.textContent = code;

      const l = document.createElement('label');
      l.setAttribute('for', code);
      l.textContent = label;

      const s = document.createElement('select');
      s.id = code;
      [0,1,2,3].forEach(v=>{
        const o = document.createElement('option');
        o.value = v;
        o.textContent = v;
        s.appendChild(o);
      });

      row.appendChild(c);
      row.appendChild(l);
      row.appendChild(s);
      card.appendChild(row);
    });

    const hint = document.createElement('div');
    hint.className = 'hint';
    hint.textContent = '各項目を0〜3で選択 → 「計算する」';
    card.appendChild(hint);

    cards.appendChild(card);
  });
}

function getScores(){
  const flat = [];
  SECTIONS.forEach(sec=>{
    sec.items.forEach(([code,label])=>{
      const v = parseInt(document.getElementById(code).value || '0', 10);
      flat.push({code,label,value:v, group: sec.key});
    });
  });
  return flat;
}

function calc(){
  const scores = getScores();

  const sumW = scores.filter(x=>x.group==='W').reduce((a,b)=>a+b.value,0);
  const sumB = scores.filter(x=>x.group==='B').reduce((a,b)=>a+b.value,0);
  const sumP = scores.filter(x=>x.group==='P').reduce((a,b)=>a+b.value,0);
  const sumT = sumW + sumB + sumP;

  const maxGroup = [{k:'仕事',v:sumW},{k:'上司',v:sumB},{k:'職場',v:sumP}].sort((a,b)=>b.v-a.v)[0].k;

  // top 5 items
  const top = scores
    .filter(x=>x.value>0)
    .sort((a,b)=>b.value-a.value)
    .slice(0,5);

  // render metrics
  const metrics = document.getElementById('metrics');
  metrics.innerHTML = '';

  const metricRow = (name, val, denom, lvl) => {
    const d = document.createElement('div');
    d.className = 'metric';
    d.innerHTML = `<div>${name} <span class="pill">${lvl}</span></div><b>${val} / ${denom}</b>`;
    return d;
  };

  metrics.appendChild(metricRow('仕事（W）', sumW, 30, level30(sumW)));
  metrics.appendChild(metricRow('上司（B）', sumB, 30, level30(sumB)));
  metrics.appendChild(metricRow('職場（P）', sumP, 30, level30(sumP)));
  metrics.appendChild(metricRow('総合（T）', sumT, 90, level90(sumT)));

  const d2 = document.createElement('div');
  d2.className = 'metric';
  d2.innerHTML = `<div>主な負担源</div><b>${maxGroup}</b>`;
  metrics.appendChild(d2);

  // render top list
  const top5 = document.getElementById('top5');
  top5.innerHTML = '';
  if (top.length === 0){
    const li = document.createElement('li');
    li.textContent = '0点が多いので、上位項目はありません（状態は良好寄り）。';
    top5.appendChild(li);
  } else {
    top.forEach(x=>{
      const li = document.createElement('li');
      li.textContent = `${x.code}（${x.value}）：${x.label}`;
      top5.appendChild(li);
    });
  }

  return {scores,sumW,sumB,sumP,sumT,maxGroup, top};
}

function buildPrompt(){
  const res = calc();
  const {scores,sumW,sumB,sumP,sumT} = res;

  const deadline = (document.getElementById('deadline').value || '').trim();
  const avoid = (document.getElementById('avoid').value || '').trim();
  const context = (document.getElementById('context').value || '').trim();

  const lines = [];
  lines.push('あなたは職場メンタル負荷の整理と対処設計の専門家です。医療的な診断はしません。点数の集計と、現実的な対処提案を行ってください。トーンは落ち着き・責めない・具体的。個人情報は要求しない。');
  lines.push('');
  lines.push('【入力スコア】');
  // Keep order W,B,P
  const fmt = (prefix) => scores.filter(x=>x.code.startsWith(prefix)).map(x=>`${x.code}=${x.value}`).join('  ');
  lines.push(fmt('W'));
  lines.push(fmt('B'));
  lines.push(fmt('P'));
  lines.push('');
  lines.push('【補足】（任意）');
  if (deadline) lines.push(`期限・直近イベント：${deadline}`);
  if (avoid) lines.push(`避けたい事故：${avoid}`);
  if (context) lines.push(`状況：${context}`);
  if (!deadline && !avoid && !context) lines.push('（未記入）');
  lines.push('');
  lines.push('やってほしいこと（順番固定）');
  lines.push('1) 集計：仕事W合計/30、上司B合計/30、職場P合計/30、総合T合計/90 を計算');
  lines.push('2) 判定：各カテゴリ（0-30）は 0-7=緑、8-15=黄、16-23=橙、24-30=赤。総合（0-90）は 0-20=緑、21-40=黄、41-60=橙、61-90=赤。');
  lines.push('3) 主要因の特定：W/B/Pのうち最大のカテゴリを「主な負担源」として宣言');
  lines.push('4) 高ストレス項目：点数が高い順に上位5つ（同点は複数OK）');
  lines.push('5) 対処：今日15分でできる行動3つ／48時間の整え方（睡眠・頭の残業を止める）／1週間の調整（仕事量・確認型・相談導線）');
  lines.push('6) 文章テンプレ：上司に送るチャット80〜120字、上司に送るメール（件名＋200〜260字）');
  lines.push('7) 注意喚起：もし「仕事W10」または「職場P10」が3なら、相談・受診・産業医/EAP等の利用を優先と明記');
  lines.push('最後に「次の一歩」を1つだけ提示してください。');

  document.getElementById('promptOut').value = lines.join('\n');
}

function resetAll(){
  SECTIONS.forEach(sec=>{
    sec.items.forEach(([code,_label])=>{
      document.getElementById(code).value = '0';
    });
  });
  document.getElementById('deadline').value = '';
  document.getElementById('avoid').value = '';
  document.getElementById('context').value = '';
  document.getElementById('promptOut').value = '';
  document.getElementById('metrics').innerHTML = '';
  document.getElementById('top5').innerHTML = '';
}

async function copyPrompt(){
  const t = document.getElementById('promptOut').value;
  if (!t) return;
  try{
    await navigator.clipboard.writeText(t);
    alert('コピーしました');
  }catch(e){
    // fallback
    const ta = document.getElementById('promptOut');
    ta.focus(); ta.select();
    document.execCommand('copy');
    alert('コピーしました');
  }
}

document.getElementById('calcBtn').addEventListener('click', calc);
document.getElementById('genPromptBtn').addEventListener('click', buildPrompt);
document.getElementById('copyPromptBtn').addEventListener('click', copyPrompt);
document.getElementById('resetBtn').addEventListener('click', resetAll);

buildUI();
</script>
</body>
</html>
